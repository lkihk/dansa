<!DOCTYPE html>
<html>
<head>
	<title>Dansa</title>
	<link href="/css/screen.css" media="all" rel="stylesheet" type="text/css" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
	<style>
		body {
			background-image: url(/songs/<%=songId%>/background.png);
		}
		.frame-container {
			display: block;
			position: absolute;
			top: 0;
			left: 0;
		}
	</style>
</head>
<body>
	<% if(backgroundUrl){ %>
	<div class="frame-container">
		<iframe frameBorder="0" class="background" id="frame" src="<%-backgroundUrl%>" width="640" height="480"></iframe>
	</div>
	<% } %>
	<div id="sm-micro" class="canvas-container">
		<!--
		<div class="button" id="button0"></div>
		<div class="button" id="button1"></div>
		<div class="button" id="button2"></div>
		<div class="button" id="button3"></div>
		-->
		<div id="bottom">
			<audio id="audio_with_controls" autobuffer controls> <!-- autoplay -->
				<source src="/songs/<%=songId%>/music.mp3" type="audio/mpeg" />
				<source src="/songs/<%=songId%>/music.ogg" type="audio/ogg" />
				Audio tag not supported
			</audio>
		</div>
	</div>
	<script type="text/javascript">
		var imgDir = "img/";
		<% if(typeof(soundCloudSong) !== 'undefined'){ %>
		var scSong = "<%-soundCloudSong%>";
		<% } %>
	</script>
	<script src="/js/jquery-1.5.1.min.js" type="text/javascript"></script>
	<% if(typeof(soundCloudSong) !== 'undefined'){
	%><script src="//connect.soundcloud.com/sdk.js" type="text/javascript"></script>
	<% }
	%><script type='text/javascript' src="/js/Dansa.js"></script>
	<script type='text/javascript' src="/js/sprite.js"></script>
	<script type='text/javascript' src="/js/Actor.js"></script>
	<script type='text/javascript' src="/js/BeatDetector.js"></script>
	<script type='text/javascript' src="/songs/<%=songId%>/song.js"></script>
	<script type='text/javascript' src="/songs/<%=songId%>/steps.js"></script>
	<script type='text/javascript' src="/js/Game.js"></script>
	<script>
		<% if(typeof(soundCloudSong) == 'undefined'){ %>
			startGame();
			var audio = document.getElementById('audio_with_controls');
			audio.play();
		<% } else { %>
			// Replace audio with SC stream
			SC.initialize({
				client_id: '<%-scClientId%>'
			});

			SC.get("/tracks/<%-soundCloudSong%>", {}, function (sound){
				var src = sound.stream_url + '?client_id=<%-scClientId%>';
				var audio = document.getElementById('audio_with_controls');
				audio.setAttribute("src", src);
				audio.play();
				song.bpm = sound.bpm;
				startGame();
				console.log(sound)
			});
		<% } %>
	</script>
</body>
</html>